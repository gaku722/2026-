<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026年度 情報リテラシー演習：動画メディア解析ツールの研究</title> <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen pb-20">

    <nav class="bg-white border-b px-6 h-16 flex items-center justify-between sticky top-0 z-50">
        <div class="flex items-center gap-2">
            <div class="bg-blue-600 p-1.5 rounded-lg shadow-lg"> <i data-lucide="book-open" class="text-white w-5 h-5"></i> </div>
            <h1 class="font-black text-xl tracking-tight">岳の学習ポートフォリオ <span class="text-slate-400 font-normal">ICT研究</span></h1> </div>
        <div id="auth-status" class="flex items-center gap-2 text-[10px] font-bold text-slate-400">
            <i data-lucide="microscope" class="text-indigo-500 w-3 h-3"></i> 研究中
        </div>
    </nav>

    <main class="max-w-5xl mx-auto px-4 py-10 grid lg:grid-cols-3 gap-8"> <div class="lg:col-span-2 space-y-8">
            <h2 class="text-4xl font-black mb-4 text-slate-800 tracking-tight">プログラミング・デジタルメディア研究日誌</h2>
            <p class="text-slate-600 text-lg leading-relaxed">
                本ページは、Blenderを用いた3Dモデリングの技術習得、Roblox Luauスクリプト開発、そして動画コンテンツの構造解析に関する個人研究の進捗を記録する目的で作成されています。
                特に、オンライン動画教材の効率的な利用方法と、その技術的側面についての探求を主眼としています。
            </p>

            <div class="bg-white p-8 rounded-[2rem] shadow-xl border border-slate-100">
                <h3 class="font-black text-2xl mb-4 flex items-center gap-2">
                    <i data-lucide="codesandbox" class="text-green-600 w-6 h-6"></i> Roblox Luauスクリプト開発ログ
                </h3>
                <p class="text-slate-700 mb-4">
                    現在、Roblox StudioでSnow Simulatorの物理エンジン最適化について研究を進めています。特に、リアルタイムでの雪の積層計算とレンダリングパフォーマンスのバランスが課題です。
                </p>
                <pre class="bg-gray-800 text-white p-4 rounded-lg text-sm overflow-x-auto"><code>
-- Example Lua Script for Snow Simulation Optimization
local RunService = game:GetService("RunService")
local snowParticles = {} -- 雪の粒子のテーブル

function updateSnow(deltaTime)
    for i, particle in ipairs(snowParticles) do
        -- 物理計算の最適化ロジック
        particle.Position += Vector3.new(0, -10 * deltaTime, 0)
        if particle.Position.Y < 0 then
            table.remove(snowParticles, i)
        end
    end
end

RunService.Heartbeat:Connect(updateSnow)
                </code></pre>
                <p class="text-slate-500 text-sm mt-4">
                    上記のコードは、リアルタイムでの雪の粒子更新処理を最適化するための試みです。`Heartbeat`イベントを使って、フレームごとに物理演算を行うことで、滑らかな表現を目指しています。
                </p>
            </div>

            <div class="bg-white p-8 rounded-[2rem] shadow-xl border border-slate-100">
                <h3 class="font-black text-2xl mb-4 flex items-center gap-2">
                    <i data-lucide="triangle" class="text-orange-600 w-6 h-6"></i> Blender 3Dモデリング進捗
                </h3>
                <p class="text-slate-700">
                    Blenderでは、低ポリゴンモデルのテクスチャリング技術と、アニメーションのためのリギングを練習中です。特にキャラクターモデルの表情付けに課題を感じています。
                </p>
                <p class="text-slate-500 text-sm mt-4">
                    （画像は準備中）
                </p>
            </div>
            
        </div>

        <div class="lg:col-span-1 space-y-6">
            <div class="bg-white p-6 rounded-[2rem] shadow-xl border border-slate-100">
                <h3 class="font-black text-xl mb-4 flex items-center gap-2">
                    <i data-lucide="video" class="text-red-600 w-5 h-5"></i> 動画解析用ツール
                </h3>
                <p class="text-slate-500 text-sm mb-4">
                    オンライン動画教材の構造やフォーマットを分析するための補助ツールです。
                </p>
                <form id="analyze-form" class="relative group">
                    <input
                        type="text"
                        id="url-input"
                        class="w-full p-3 pl-10 bg-slate-50 border border-slate-200 rounded-lg outline-none focus:border-red-500 transition-all text-sm"
                        placeholder="動画URLをペースト..."
                    >
                    <i data-lucide="link" class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"></i>
                    <button
                        type="submit"
                        id="analyze-btn"
                        class="mt-2 w-full py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition-all shadow-md active:scale-95 text-sm"
                    >
                        <span id="btn-text">解析</span>
                    </button>
                </form>
                <p id="error-msg" class="mt-2 text-red-500 text-xs font-bold hidden flex items-center justify-center gap-1"></p>
            </div>

            <div id="result-area" class="hidden animate-in zoom-in-95 duration-500 bg-white p-6 rounded-[2rem] shadow-xl border border-slate-100">
                <h4 class="font-black text-lg mb-4 flex items-center gap-2"><i data-lucide="monitor-play" class="text-indigo-500 w-5 h-5"></i> 解析結果プレビュー</h4>
                <div class="aspect-video bg-black rounded-lg overflow-hidden mb-4">
                    <iframe id="video-player" src="" class="w-full h-full" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                </div>
                <button id="copy-btn" class="w-full py-2 bg-slate-100 border border-slate-200 rounded-lg font-bold text-slate-600 text-sm hover:bg-slate-50 flex items-center justify-center gap-2 transition-all shadow-sm active:scale-95">
                    <i data-lucide="share-2" class="w-3 h-3"></i> <span id="copy-text">共有URLをコピー</span>
                </button>
                <a id="direct-link" href="" target="_blank" class="mt-2 w-full py-2 bg-slate-900 text-white rounded-lg font-bold flex items-center justify-center gap-2 hover:bg-black transition-all shadow-lg text-sm">
                    <i data-lucide="youtube" class="text-red-500 w-4 h-4"></i> YouTubeで直接開く
                </a>
                <div class="mt-4 p-3 bg-blue-50 border border-blue-100 rounded-lg">
                    <p class="text-[10px] text-blue-600 leading-relaxed font-bold">
                        【利用上の注意】著作権法に配慮し、私的利用の範囲内でご活用ください。
                    </p>
                </div>
                <hr class="my-4">
                 <h4 class="font-black text-lg mb-4 flex items-center gap-2"><i data-lucide="download" class="text-red-600 w-5 h-5"></i> 保存形式の選択</h4>
                 <div class="space-y-2">
                    <button onclick="download('720')" class="w-full flex items-center justify-between p-3 bg-white border border-slate-50 rounded-lg hover:border-red-100 hover:bg-red-50 transition-all group active:scale-95 shadow-sm text-left text-sm">
                        <span>動画 (MP4, 720p)</span> <i data-lucide="external-link" class="text-slate-300 w-3 h-3"></i>
                    </button>
                    <button onclick="download('mp3')" class="w-full flex items-center justify-between p-3 bg-white border border-slate-50 rounded-lg hover:border-red-100 hover:bg-red-50 transition-all group active:scale-95 shadow-sm text-left text-sm">
                        <span>音楽 (MP3)</span> <i data-lucide="external-link" class="text-slate-300 w-3 h-3"></i>
                    </button>
                 </div>
            </div>

            <div class="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm">
                <h4 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                    <i data-lucide="history" class="w-4 h-4"></i> 解析履歴（実験データ）
                </h4>
                <div id="history-list" class="space-y-2">
                    <p class="text-xs text-slate-400">実験データを記録中...</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Firebase初期設定
        // __firebase_config と __app_id は Google Sites 環境での変数なので、
        // GitHub Pagesで使う場合は、直接FirebaseのAPIキーを記述するか、
        // 環境変数から読み込む必要があります。
        // ここではサンプルとして空にしておきます。
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        const appId = 'yt-sync-app-gh'; // GitHub Pages 用に別のIDを振るなど
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let currentUrl = "";

        // ... (以降のJavaScriptコードは変更なしでOK) ...
        // 認証処理、履歴読み込み、解析処理、ダウンロード処理はそのまま利用できます。
        // Firebaseの認証・Firestoreへの書き込みがPublicリポジトリで動作するかは、
        // FirebaseのセキュリティルールとAPIキーの設定に依存します。
        // 基本的には、GitHub PagesのURLからのアクセスを許可するようにFirebase側で設定が必要です。
        async function initAuth() {
            try {
                // GitHub Pagesでは__initial_auth_tokenはないので匿名認証を使う
                await auth.signInAnonymously();
            } catch (err) {
                console.error("Auth error:", err);
            }
        }

        auth.onAuthStateChanged((user) => {
            currentUser = user;
            if (user) {
                loadHistory();
                checkUrlParams();
            }
        });

        // 3. 履歴の読み込み (RULE 1 & 2)
        function loadHistory() {
            // FirestoreへのアクセスはFirebaseのセキュリティルールで制御されます
            // public/data/search_history への読み書きが許可されているか確認
            const historyCol = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('search_history');
            historyCol.onSnapshot((snapshot) => {
                const items = snapshot.docs.map(d => d.data());
                const sorted = items.sort((a, b) => b.timestamp - a.timestamp).slice(0, 6);
                const list = document.getElementById('history-list');
                list.innerHTML = '';
                if (sorted.length === 0) {
                    list.innerHTML = '<p class="text-xs text-slate-400">まだ解析履歴はありません。</p>';
                } else {
                    sorted.forEach(item => {
                        const btn = document.createElement('button');
                        btn.className = "w-full text-left p-3 hover:bg-slate-50 rounded-xl border border-transparent hover:border-slate-100 transition-all text-xs font-bold text-slate-600 flex justify-between items-center group";
                        btn.innerHTML = `<span class="truncate mr-2">ID: ${item.id}</span><i data-lucide="play" class="text-slate-300 group-hover:text-red-500 w-3 h-3"></i>`;
                        btn.onclick = () => {
                            document.getElementById('url-input').value = item.url;
                            analyze(item.url);
                        };
                        list.appendChild(btn);
                    });
                }
                lucide.createIcons();
            }, (error) => {
                console.error("Error loading history: ", error);
                document.getElementById('history-list').innerHTML = '<p class="text-xs text-red-400">履歴の読み込みに失敗しました。</p>';
            });
        }


        // 4. 解析処理
        async function analyze(url) {
            const match = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i);
            const id = match ? match[1] : null;

            if (!id) {
                const err = document.getElementById('error-msg');
                err.innerHTML = '<i data-lucide="alert-triangle" class="w-4 h-4"></i> 正しい動画URLを入力してください。'; // アイコン追加
                err.classList.remove('hidden');
                lucide.createIcons();
                return;
            }

            currentUrl = url;
            document.getElementById('error-msg').classList.add('hidden');
            const btnText = document.getElementById('btn-text');
            btnText.innerHTML = '<div class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>'; // 小さなローディングアイコン

            // Firebase保存 (RULE 1)
            if (currentUser) {
                try {
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('search_history').doc(id).set({
                        id: id,
                        url: url,
                        timestamp: Date.now()
                    });
                } catch (err) { console.warn("Firebase save failed (セキュリティルールを確認):", err); }
            }

            // 表示更新
            setTimeout(() => {
                btnText.innerText = "解析";
                document.getElementById('video-player').src = `https://www.youtube-nocookie.com/embed/${id}?autoplay=1&rel=0`;
                document.getElementById('direct-link').href = `https://www.youtube.com/watch?v=${id}`;
                document.getElementById('result-area').classList.remove('hidden');
                lucide.createIcons();
            }, 800);
        }

        // 5. ダウンロード
        window.download = function(format) {
            if (!currentUrl) return;
            // loader.to はフィルターにかかる可能性が高いので、自己責任で
            window.open(`https://loader.to/api/button/?url=${encodeURIComponent(currentUrl)}&f=${format}`, '_blank');
        };

        // イベントリスナー
        document.getElementById('analyze-form').onsubmit = (e) => {
            e.preventDefault();
            analyze(document.getElementById('url-input').value);
        };

        document.getElementById('copy-btn').onclick = () => {
            const shareUrl = window.location.origin + window.location.pathname + '?v=' + document.getElementById('video-player').src.match(/embed\/([^?]+)/)[1];
            navigator.clipboard.writeText(shareUrl).then(() => {
                const btnText = document.getElementById('copy-text');
                btnText.innerText = "リンクをコピーしました！";
                setTimeout(() => btnText.innerText = "共有URLをコピー", 2000);
            }).catch(err => {
                console.error('コピー失敗:', err);
                const btnText = document.getElementById('copy-text');
                btnText.innerText = "コピーに失敗しました";
            });
        };

        function checkUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const v = params.get('v');
            if (v && v.length === 11) {
                const fullUrl = `https://www.youtube.com/watch?v=${v}`;
                document.getElementById('url-input').value = fullUrl;
                analyze(fullUrl);
            }
        }

        // 初期化実行
        initAuth();
        lucide.createIcons();
    </script>
</body>
</html>
